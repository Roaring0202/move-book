<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Resource - Move Book</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> The Move Language</a></li><li class="chapter-item expanded "><a href="../introduction/foreword.html"><strong aria-hidden="true">2.</strong> Foreword</a></li><li class="chapter-item expanded "><a href="../introduction/move.or.mvir.html"><strong aria-hidden="true">3.</strong> Move or Mvir</a></li><li class="chapter-item expanded "><a href="../introduction/getting-started.html"><strong aria-hidden="true">4.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../chapters/syntax-basics.html"><strong aria-hidden="true">5.</strong> Syntax Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapters/concept.html"><strong aria-hidden="true">5.1.</strong> Concept</a></li><li class="chapter-item expanded "><a href="../chapters/primitives.html"><strong aria-hidden="true">5.2.</strong> Primitive Types</a></li><li class="chapter-item expanded "><a href="../chapters/comments.html"><strong aria-hidden="true">5.3.</strong> Comments</a></li><li class="chapter-item expanded "><a href="../chapters/expression-and-scope.html"><strong aria-hidden="true">5.4.</strong> Expression and Scope</a></li><li class="chapter-item expanded "><a href="../chapters/control-flow.html"><strong aria-hidden="true">5.5.</strong> Control Flow</a></li><li class="chapter-item expanded "><a href="../chapters/module.html"><strong aria-hidden="true">5.6.</strong> Module</a></li><li class="chapter-item expanded "><a href="../chapters/function.html"><strong aria-hidden="true">5.7.</strong> Function</a></li><li class="chapter-item expanded "><a href="../chapters/struct.html"><strong aria-hidden="true">5.8.</strong> Structures</a></li></ol></li><li class="chapter-item expanded "><a href="../chapters/advanced-topics.html"><strong aria-hidden="true">6.</strong> Advanced Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapters/references.html"><strong aria-hidden="true">6.1.</strong> References</a></li><li class="chapter-item expanded "><a href="../chapters/generics.html"><strong aria-hidden="true">6.2.</strong> Generics</a></li><li class="chapter-item expanded "><a href="../chapters/vector.html"><strong aria-hidden="true">6.3.</strong> Vector</a></li><li class="chapter-item expanded "><a href="../chapters/resource.html" class="active"><strong aria-hidden="true">6.4.</strong> Resource</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Move Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#resources" id="resources">Resources</a></h1>
<p>Resources are what makes Move unique, safe and powerful.
First, let's see description from <a href="https://developers.libra.org/docs/move-overview#move-has-first-class-resources">libra developers portal</a>:</p>
<blockquote>
<ul>
<li>The key feature of Move is the ability to define custom resource types. <strong>Resource types are used to encode safe digital assets with rich programmability</strong>.</li>
<li><strong>Resources are ordinary values in the language</strong>. They can be stored as data structures, passed as arguments to procedures, returned from procedures, and so on.</li>
<li><strong>The Move type system provides special safety guarantees for resources</strong>. Move resources can never be duplicated, reused, or discarded. A resource type can only be created or destroyed by the module that defines the type. These guarantees are enforced statically by the Move virtual machine via bytecode verification. The Move virtual machine will refuse to run code that has not passed through the bytecode verifier.</li>
<li>The Libra currency is implemented as a resource type named LibraCoin.T. LibraCoin.T has no special status in the language; every Move resource enjoys the same protections.</li>
</ul>
</blockquote>
<h2><a class="header" href="#resource-concept" id="resource-concept">Resource concept</a></h2>
<p>Imagine you open a safe deposit box at the bank. Since it's a bank you trust it with alls the contents of your deposit box, and you know that bank will guard it and manage access policy correctly so you and only you (except special occasions in your agreement) can control contents of this deposit box.</p>
<p>What could be the properties of this deposit box?</p>
<ul>
<li>an owner - it is you</li>
<li>it's created for owner (you) by bank - trusted side</li>
<li>deposit box's access policy is managed by bank and you know it before signing</li>
<li>deposit box may contain anything - there's no limit</li>
<li>deposit box can be moved or destroyed by you or by bank (if your agreement allows it)</li>
<li>deposit box access may be shared (again - if it's specified in terms)</li>
</ul>
<p>That's pretty much what's going on in Move. Every resource is a deposit box and just like deposit box - it is user-specific. For each user deposit deal goes full path from creation (or <em>initialization</em>) to using (or <em>modification</em>) and optionally to <em>destruction</em>. I suggest you keep in mind this analogy as it will help you understand resource concept.</p>
<h2><a class="header" href="#resource-life-time" id="resource-life-time">Resource life time</a></h2>
<p>Resource in Move is defined as a <code>resource struct</code> and just like <code>struct</code> it can only be defined within module context, and unlike struct, resource will outlive your script. To understand that let's look at this example:</p>
<pre><code class="language-Move">// here's our module to manage records on chain
module RecordsCollection {

    use 0x0::Transaction as Tx;

    // the very basic information about our record
    struct Record {
        name: vector&lt;u8&gt;,
        author: vector&lt;u8&gt;,
        year: u64
    }

    // imaginary collection of records
    struct Collection {
        records: vector&lt;Record&gt;
    }

    public fun create_record(name: vector&lt;u8&gt;, author: vector&lt;u8&gt;, year: u64): Record {
        Record { name, author, year }
    }
}
</code></pre>
<p>What happens if we use module <code>RecordsCollection</code> in a script and call a method <code>add_new()</code>? New struct will be created in a script context. What happens when script scope ends? All defined variables and structs will be dumped:</p>
<pre><code class="language-Move">use {{sender}}::RecordsCollection as Collection;

fun main(name: vector&lt;u8&gt;, author: vector&lt;u8&gt;, year: u64) {

    let r = Collection::create_record(name, author, year);

    // record is created but it saved somewhere?
    // where does it go when script ends? nowhere!
}
</code></pre>
<p>Going further: even if we created <code>Collection</code> struct and pushed newly created <code>Record</code> in it, whole collection would still have been gone by the end of scope.</p>
<blockquote>
<p>That's when the <strong><code>resource struct</code></strong> comes into play. It can be saved, accessed,  updated and destroyed. It outlives the script and affects blockchain state.</p>
</blockquote>
<h2><a class="header" href="#how-to-work-with-resource" id="how-to-work-with-resource">How to work with <code>resource</code></a></h2>
<p>Let's modify our example with RecordsCollection (imagine we want to store our catalogue in blockchain). Even better - we will let anyone manage their record collection.</p>
<h2><a class="header" href="#make-struct-a-resource-struct" id="make-struct-a-resource-struct">Make <code>struct</code> a <code>resource struct</code></a></h2>
<p>First order of business - turning <code>struct</code> into <code>resource struct</code>. We will do it only for collection (you'll see why):</p>
<pre><code class="language-Move">resource struct Collection {
    records: vector&lt;Record&gt;
}
</code></pre>
<p>Even better (or say more correct) way to name main resource in module is <code>&quot;T&quot;</code>:</p>
<pre><code class="language-Move">// since whole module is named RecordsCollection
// everyone will understand that T equals Collection
resource struct T {
    records: vector&lt;Record&gt;
}
</code></pre>
<!-- MB rewrite this part later when done with structure; -->
<p>As you can see, nothing but an addition of one keyword. What actually happens? Collection remains a type. Just like struct you can initialize it (in resource-specific way), you can push records into it and (!) what's really important: this <code>resource struct</code> will be saved on chain linked to your address making it possible to read and change it again in future transactions. Even more! If module is properly organized, you can even let other people see your collection, and (only if you want to do so!) you can let them add records into your collection.</p>
<!-- END;  -->
<p>TLDR; It's time to code!</p>
<p>Move has 5 built-in functions to work with collections, we'll go through all of them in order.</p>
<h2><a class="header" href="#attach-resource-with-move_to_sender" id="attach-resource-with-move_to_sender">Attach resource with <code>move_to_sender</code></a></h2>
<p>To start working with resource, you need it to be attached to sender. Please keep in mind that the only place where you can manage <code>structs</code> and <code>resources</code> is their module. You can't init resource outside the module context but you can provide <code>public</code> method. That's how you do it:</p>
<pre><code class="language-Move">module RecordsCollection {

    use 0x0::Vector;

    // -- some definitions skipped --

    resource struct T {
        records: vector&lt;Record&gt;
    }

    public fun initialize() {
        move_to_sender&lt;T&gt;(T { records: Vector::empty() })
    }
}
</code></pre>
<blockquote>
<p>Function <code>move_to_sender&lt;RESOURCE&gt;(RESOURCE)</code> links resource to account. It uses some internal magic to define transaction sender so there's no need to specify one.</p>
</blockquote>
<h2><a class="header" href="#check-if-resource-exists-at-given-address" id="check-if-resource-exists-at-given-address">Check if resource <code>exists</code> at given address</a></h2>
<p>It's good to initialize resource once but not to be mistaken and not to inizalize it twice we can check if resource is linked to address. Here's how it looks if we modify previously defined <code>initialize()</code> function:</p>
<pre><code class="language-Move">module RecordsCollection {

    // -- some definitions skipped --

    use 0x0::Transaction as Tx;

    public fun initialize() {
        let sender = Tx::sender();

        if (!exists&lt;T&gt;(sender)) {
            move_to_sender&lt;T&gt;(T { records: Vector::empty() })
        }
    }
}
</code></pre>
<blockquote>
<p>Function <code>exists&lt;RESOURCE&gt;(&lt;ADDRESS&gt;): bool</code> checks if resource is linked to address and returns boolean result. You can use this function to check any resource and any address - this information is meant to be public on blockchain.</p>
</blockquote>
<h2><a class="header" href="#using-existing-resources-with-acquires" id="using-existing-resources-with-acquires">Using existing resources with <code>acquires</code></a></h2>
<p>Before we proceed. There is a huge difference between <em>using</em> resource and <em>checking or initializing</em> it. When you initialize resource you create a link between newly created resource, when you check existence you actually check this link exists. But when you <em>read</em>, <em>modify</em> or <em>destroy</em> resource, you need to actually <strong>use resource</strong>.</p>
<p>That is when keyword <code>acquires</code> appears. If your function <em>reads</em>, <em>modifies</em> or <em>destroys</em> resource, you MUST put this keyword. Here's how:</p>
<pre><code class="language-Move">module RecordsCollection {

    // here's our resource T
    resource struct T {
        records: vector&lt;Record&gt;
    }

    // and here we're going to read our resource T
    public fun get_my_records(): vector&lt;Record&gt; acquires T {
        // ...
    }
</code></pre>
<blockquote>
<p>Keyword <code>acquires</code> is put only in function definition after return value or parentheses (when function has no return value). Resource names <em>acquired</em> by this function have to be listed after. If there're multiple resources, use comma-separated list: <code>fun my_fun() acquires R1, R2</code>.</p>
</blockquote>
<p>Functions requiring <code>acquire</code>:</p>
<ul>
<li>borrow_global_mut</li>
<li>borrow_global</li>
<li>move_from</li>
</ul>
<h2><a class="header" href="#read-resource-contents-with-borrow_global" id="read-resource-contents-with-borrow_global">Read resource contents with <code>borrow_global</code></a></h2>
<p>Okay, we've already linked resource to sender account and even protected ourselves from double initialization, it's time to learn to read it.</p>
<pre><code class="language-Move">module RecordsCollection {

    // -- some definitions skipped --

    use 0x0::Transaction as Tx;

    resource struct T {
        records: vector&lt;Record&gt;
    }

    public fun get_my_records(): vector&lt;Record&gt; acquires T {

        let sender = Tx::sender();
        let collection = borrow_global&lt;T&gt;(sender);

        *&amp;collection.records
    }
}
</code></pre>
<blockquote>
<p>Function <code>borrow_global&lt;RESOURCE&gt;(&lt;ADDRESS&gt;): &amp;&lt;RESOURCE&gt;</code> requests immutable reference to resource at given address. You can read resource contents just how you'd normally read struct's.</p>
</blockquote>
<h2><a class="header" href="#modify-resource-with-borrow_global_mut" id="modify-resource-with-borrow_global_mut">Modify resource with <code>borrow_global_mut</code></a></h2>
<p>We've come a long way to get here, and finally we're ready to learn how to modify resource.</p>
<pre><code class="language-Move">module RecordsCollection {

    // -- some definitions skipped --

    use 0x0::Transaction as Tx;
    use 0x0::Vector;

    resource struct T {
        records: vector&lt;Record&gt;
    }

    public fun add_record(
        name: vector&lt;u8&gt;,
        author: vector&lt;u8&gt;,
        year: u64
    ) acquires T {

        let sender = Tx::sender();

        // not to do additional call let's put it here
        initialize(sender);

        let record = Record { name, author, year };
        let collection = borrow_global_mut&lt;T&gt;(sender);

        Vector::push_back(&amp;mut collection.records, record)
    }
}
</code></pre>
<blockquote>
<p>Function <code>borrow_global_mut&lt;RESOURCE&gt;(&lt;ADDRESS&gt;): &amp;mut &lt;RESOURCE&gt;</code> creates mutable reference to resource at given address. All the changes you apply via this mutable reference are going to be stored on chain.</p>
</blockquote>
<h2><a class="header" href="#remove-resource-with-move_from" id="remove-resource-with-move_from">Remove resource with <code>move_from</code></a></h2>
<p>Finally, to destroy our RecordCollection we will use <code>move_from</code> method.</p>
<pre><code class="language-Move">module RecordsCollection {

    // -- some definitions skipped --

    resource struct T {
        records: vector&lt;Record&gt;
    }

    // see return value here, it is important!
    public fun destroy_collection(): T acquires T {

        let sender = Tx::sender();

        move_from&lt;T&gt;(sender)
    }
}
</code></pre>
<p>Even though it looks simple - it's not. <code>move_from</code> is the most tricky of all methods in this article. Let's go through rules:</p>
<ol>
<li>Value returned by <code>move_from</code> MUST be used; it can also be desctructured!</li>
<li>You can't destroy resource twice as there's no resource on your account;</li>
<li>Value returned by <code>move_from</code> is a full (non-reference) instance of resource.</li>
</ol>
<p>That's it. Let's summarise.</p>
<blockquote>
<p>To remove resource from address use <code>move_from&lt;RESOURCE&gt;(&lt;ADDRESS&gt;): &lt;RESOURCE&gt;</code> method. Returned value MUST be used (eg passed as return value of destroy function).</p>
</blockquote>
<h2><a class="header" href="#final-contract" id="final-contract">Final contract</a></h2>
<p>Here's final contract. What it does:</p>
<ul>
<li>allows anyone store their own RecordCollection on chain;</li>
<li>provides security for RecordCollection - only owner can access it.</li>
</ul>
<pre><code class="language-Move">module RecordsCollection {

    use 0x0::Transaction as Tx;
    use 0x0::Vector;

    struct Record {
        name:   vector&lt;u8&gt;,
        author: vector&lt;u8&gt;,
        year:   u64
    }

    resource struct T {
        records: vector&lt;Record&gt;
    }

    fun initialize(sender: address) {
        if (!::exists&lt;T&gt;(sender)) {
            move_to_sender&lt;T&gt;(T { records: Vector::empty() })
        }
    }

    public fun add_record(
        name: vector&lt;u8&gt;,
        author: vector&lt;u8&gt;,
        year: u64
    ) acquires T {

        let sender = Tx::sender();

        initialize(sender);

        let record = Record { name, author, year };
        let collection = borrow_global_mut&lt;T&gt;(sender);

        Vector::push_back(&amp;mut collection.records, record)
    }

    public fun get_my_records(): vector&lt;Record&gt; acquires T {
        let sender = Tx::sender();
        let collection = borrow_global&lt;T&gt;(sender);

        *&amp;collection.records
    }

    public fun remove_from_me(): T acquires T {
        move_from&lt;T&gt;(Tx::sender())
    }
}
</code></pre>
<h2><a class="header" href="#list-of-functions-for-resource" id="list-of-functions-for-resource">List of functions for resource</a></h2>
<p>For reference here's list of methods:</p>
<pre><code class="language-Move">exists&lt;T&gt;(&lt;ADDRESS&gt;);  // check if resource exists at given address
move_to_sender&lt;T&gt;(T);  // move newly created resource to sender

// ones below require `acquires` keyword:

borrow_global&lt;T&gt;(&lt;ADDRESS&gt;);
borrow_global_mut&lt;T&gt;(&lt;ADDRESS&gt;);
move_from&lt;T&gt;(&lt;ADDRESS&gt;); // destroy resource
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../chapters/vector.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../chapters/vector.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
